<div class="password-reset-container">
  <div class="card password-reset-card">
    <h1>Reset de Senha</h1>
    
    <!-- ETAPA 1: Solicitação -->
    <div *ngIf="step === 'request'" class="step-content">
      <p class="subtitle">Informe seu email para receber o código de verificação via SMS</p>

      <form (ngSubmit)="requestReset()" #requestForm="ngForm">
        <div class="form-group">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            [(ngModel)]="email"
            required
            [disabled]="loading"
            placeholder="seu.email@exemplo.com"
            pInputText
          />
        </div>

        <p-button
          type="submit"
          label="Enviar Código"
          size="large"
          [loading]="loading"
          [disabled]="loading || !email"
          styleClass="w-full">
        </p-button>
      </form>
    </div>

    <!-- ETAPA 2: Validação OTP -->
    <div *ngIf="step === 'validate'" class="step-content">
      <p class="subtitle">Digite o código de 6 dígitos recebido via SMS</p>

      <form (ngSubmit)="validateOtp()" #validateForm="ngForm">
        <div class="form-group">
          <label for="otpCode">Código OTP</label>
          <input
            type="text"
            id="otpCode"
            name="otpCode"
            [(ngModel)]="otpCode"
            required
            [disabled]="loading"
            placeholder="000000"
            maxlength="6"
            pattern="[0-9]{6}"
            pInputText
          />
          <small class="form-hint">Código enviado para o telefone cadastrado no sistema</small>
        </div>

        <div class="button-group">
          <p-button
            type="button"
            label="Voltar"
            severity="secondary"
            [disabled]="loading"
            (onClick)="goBack()"
            styleClass="w-full">
          </p-button>
          <p-button
            type="submit"
            label="Validar Código"
            size="large"
            [loading]="loading"
            [disabled]="loading || !otpCode || otpCode.length !== 6"
            styleClass="w-full">
          </p-button>
        </div>
      </form>
    </div>

    <!-- ETAPA 3: Confirmação -->
    <div *ngIf="step === 'confirm'" class="step-content">
      <p class="subtitle">Defina sua nova senha</p>

      <form (ngSubmit)="confirmReset()" #confirmForm="ngForm">
        <div class="form-group">
          <label for="newPassword">Nova Senha</label>
          <p-password
            id="newPassword"
            name="newPassword"
            [(ngModel)]="newPassword"
            [feedback]="true"
            [toggleMask]="true"
            [disabled]="loading"
            placeholder="Digite sua nova senha"
            required>
          </p-password>
          <small class="form-hint">
            Mínimo 8 caracteres, com letra maiúscula, minúscula e número
          </small>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirmar Senha</label>
          <p-password
            id="confirmPassword"
            name="confirmPassword"
            [(ngModel)]="confirmPassword"
            [toggleMask]="true"
            [disabled]="loading"
            placeholder="Confirme sua nova senha"
            required>
          </p-password>
        </div>

        <div class="button-group">
          <p-button
            type="button"
            label="Voltar"
            severity="secondary"
            [disabled]="loading"
            (onClick)="goBack()"
            styleClass="w-full">
          </p-button>
          <p-button
            type="submit"
            label="Confirmar Reset"
            size="large"
            [loading]="loading"
            [disabled]="loading || !newPassword || !confirmPassword || newPassword !== confirmPassword"
            styleClass="w-full">
          </p-button>
        </div>
      </form>
    </div>
  </div>
</div>

